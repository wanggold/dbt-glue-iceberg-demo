-- Macro to define transaction JSON schema for reusability
{% macro transaction_json_schema() %}
    'struct<
        _id:string,
        gnId:string,
        status:string,
        type:string,
        platform:string,
        appType:string,
        currency:string,
        amount:double,
        purchaseDateMs:string,
        completedAt:string,
        refundedAt:string,
        createdAt:string,
        updatedAt:string,
        platformProductIdentifier:string,
        transactionId:string,
        ownerType:string,
        customerSubscription:string,
        marketplaceProductId:string,
        expireDateMs:string,
        originalTransaction:struct<
            product_id:string,
            original_transaction_id:string,
            transaction_id:string,
            is_trial_period:string,
            is_in_intro_offer_period:string,
            in_app_ownership_type:string,
            is_family_share:string,
            purchase_date:string,
            purchase_date_pst:string,
            purchase_date_ms:string,
            original_purchase_date:string,
            original_purchase_date_ms:string,
            original_purchase_date_pst:string,
            type:string,
            subscription_group_identifier:string,
            expires_date_ms:string,
            expires_date:string,
            expires_date_pst:string,
            web_order_line_item_id:string,
            transactionReason:string,
            signedDate:string,
            quantity:string,
            originalTransactionId:string,
            price:string,
            currency:string,
            price_in_purchased_currency:string,
            offerDiscountType:string,
            offerPeriod:string,
            offerType:string,
            store:string,
            storefront:string,
            storefrontId:string,
            environment:string,
            productId:string,
            app_account_token:string,
            appTransactionId:string,
            app_user_id:string,
            purchaseDate:string,
            originalPurchaseDate:string,
            expiresDate:string,
            bundleId:string,
            id:string,
            event_timestamp_ms:string,
            extras:struct<
                isLifetimePurchase:string
            >
        >,
        extraInfo:struct<
            countryCode:string,
            transactionSource:string,
            isSandbox:string,
            bundleTransactionId:string,
            productPurchaseType:string,
            priceTier:string,
            trackInfo:struct<
                productName:string,
                creatorName:string,
                productType:string,
                experiments:array<struct<
                    name:string,
                    userGroup:string
                >>
            >
        >
    >'
{% endmacro %}
